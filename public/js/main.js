$(document).ready(function(){var e=document.getElementById("canvas_coord"),o=e.getContext("2d"),t=document.getElementById("canvas"),l=t.getContext("2d"),r=[],i=34,c=i/2,a=$(".color_picker").val(),n=$(".bg_color").val(),s=$(".pindou_shape:checked").val(),f=$(".siser_col").val(),h=$(".siser_row").val();function v(){var l=f*i,c=h*i;e.width=l+100,e.height=c+100,t.width=l+100,t.height=c+100;for(var a=20;a<=c+20;a+=i)o.beginPath(),o.fillStyle="#000",o.fillText((a-20)/i,0,a-20),o.moveTo(20,a),o.lineTo(l+20,a),o.closePath(),o.stroke();for(a=20;a<=l+20;a+=i)o.beginPath(),o.fillText((a-20)/i,a-20,10),o.moveTo(a,20),o.lineTo(a,c+20),o.closePath(),o.stroke();r=[];for(var n=0;n<f;n++){r[n]=[];for(var s=0;s<h;s++)r[n][s]=0}O(".color_count").html("0")}function u(e){var o,t,n,v,u=parseInt((e.offsetX-c)/i),g=parseInt((e.offsetY-c)/i);if(!(u<f&&g<h))return!1;if("rectangle"==s){if(0!=r[u][g]&&1!=r[u][g])return void d(u,g);n=u,v=g,a=$(".color_picker").val(),n>=0&&n<f&&v>=0&&v<h&&(l.fillStyle=a,l.beginPath(),l.rect(20+i*n+2,20+i*v+2,i-4,i-4),l.closePath(),l.fill(),r[n][v]=a)}else{if(0!=r[u][g]&&1!=r[u][g])return void d(u,g);o=u,t=g,a=$(".color_picker").val(),o>=0&&o<f&&t>=0&&t<h&&(l.fillStyle=a,l.beginPath(),l.arc(20+c*(1+2*o),20+c*(1+2*t),c-4,0,2*Math.PI,!0),l.closePath(),l.fill(),r[o][t]=a)}}function d(e,o){l.beginPath(),l.clearRect(20+i*e+1,20+i*o+1,i-2,i-2),l.closePath(),r[e][o]=1}v(),O("#canvas").mousedown(function(e){u(e)}),O(".siser_ok").click(function(){if(1!=confirm("更换画布会清空拼豆，是否确定？"))return!1;f=$(".siser_col").val(),h=$(".siser_row").val(),l.clearRect(0,0,t.width,t.height),v()}),O(".clear_canvas").click(function(){if(1!=confirm("是否确定清空？"))return!1;l.clearRect(0,0,t.width,t.height),v()}),$(".color_picker").minicolors({letterCase:"uppercase"}),$(".bg_color").minicolors({letterCase:"uppercase",hide:function(){O("&body").setCss({backgroundColor:$(this).val()}),n=$(this).val();for(var e=0;e<f;e++)for(var o=0;o<h;o++)1==r[e][o]&&(l.fillStyle=n,l.beginPath(),l.rect(20+i*e+1,20+i*o+1,i-2,i-2),l.closePath(),l.fill())}}),$(".pindou_shape").change(function(){s=$(".pindou_shape:checked").val()})});