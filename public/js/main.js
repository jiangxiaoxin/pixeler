$(document).ready(function(){var n=document.getElementById("canvas_coord"),i=new EasyCanvas("canvas_coord"),t=document.getElementById("canvas"),s=EasyCanvas("canvas"),l=[],v=34,f=v/2,u=$(".color_picker").val(),h=$(".pindou_shape:checked").val(),d=($(".pindou_tool:checked").val(),$(".siser_col").val()),_=$(".siser_row").val();function e(){var e=d*v,a=_*v;n.width=e+100,n.height=a+100,t.width=e+100,t.height=a+100;for(var c=20;c<=a+20;c+=v)i.text({basic:[0,c-20,(c-20)/v]}).line({basic:[[20,c],[e+20,c]],strokeColor:"#000"});for(c=20;c<=e+20;c+=v)i.text({basic:[c-20,12,(c-20)/v]}).line({basic:[[c,20],[c,a+20]]});l=[];for(var o=0;o<d;o++){l[o]=[];for(var r=0;r<_;r++)l[o][r]=0}$(".color_count").html("0")}function p(e,a){s.clean(20+v*e+1,20+v*a+1,v-2,v-2),l[e][a]=1}e(),$("#canvas").mousedown(function(e){!function(e){var a=parseInt((e.offsetX-f)/v),c=parseInt((e.offsetY-f)/v);{if(!(a<d&&c<_))return;if("rectangle"==h){if(0!=l[a][c]&&1!=l[a][c])return p(a,c);n=a,i=c,u=$(".color_picker").val(),0<=n&&n<d&&0<=i&&i<_&&(s.rect({basic:[20+v*n+2,20+v*i+2,v-4,v-4],strokeColor:"transparent",fillColor:u}),l[n][i]=u)}else{if(0!=l[a][c]&&1!=l[a][c])return p(a,c);o=a,r=c,u=$(".color_picker").val(),0<=o&&o<d&&0<=r&&r<_&&(s.arc({basic:[20+f*(1+2*o),20+f*(1+2*r),f-4,0,2*Math.PI],strokeColor:u,fillColor:u}),l[o][r]=u)}}var o,r;var n,i}(e)}),$(".color_picker").minicolors({letterCase:"uppercase"}),$(".pindou_shape").change(function(){h=$(".pindou_shape:checked").val()}),$(".clear_canvas").click(function(){if(1!=confirm("是否确定清空？"))return!1;s.clean(0,0,n.width,n.height)}),$(".siser_ok").click(function(){if(1!=confirm("更换画布会清空拼豆，是否确定？"))return!1;d=$(".siser_col").val(),_=$(".siser_row").val(),i.clean(0,0,t.width,t.height),e()}),$("#save_canvas").click(function(){s.toImg("save_canvas",$("#pic_name").val())})});