$(document).ready(function(){var e=document.getElementById("canvas_coord"),r=new EasyCanvas("canvas_coord"),o=document.getElementById("canvas"),a=EasyCanvas("canvas"),c=[],n=34,i=n/2,t=$(".color_picker").val(),s=$(".pindou_shape:checked").val(),l=$(".siser_col").val(),v=$(".siser_row").val();function f(){var a=l*n,i=v*n;e.width=a+100,e.height=i+100,o.width=a+100,o.height=i+100;for(var t=20;t<=i+20;t+=n)r.text({basic:[0,t-20,(t-20)/n]}).line({basic:[[20,t],[a+20,t]],strokeColor:"#000"});for(t=20;t<=a+20;t+=n)r.text({basic:[t-20,12,(t-20)/n]}).line({basic:[[t,20],[t,i+20]]});c=[];for(var s=0;s<l;s++){c[s]=[];for(var f=0;f<v;f++)c[s][f]=0}$(".color_count").html("0")}function u(e,r){a.clean(20+n*e+1,20+n*r+1,n-2,n-2),c[e][r]=1}f(),$("#canvas").mousedown(function(e){!function(e){var r=parseInt((e.offsetX-i)/n),o=parseInt((e.offsetY-i)/n);{if(!(r<l&&o<v))return!1;if("rectangle"==s){if(0!=c[r][o]&&1!=c[r][o])return void u(r,o);h=r,_=o,t=$(".color_picker").val(),h>=0&&h<l&&_>=0&&_<v&&(a.rect({basic:[20+n*h+2,20+n*_+2,n-4,n-4],strokeColor:"transparent",fillColor:t}),c[h][_]=t)}else{if(0!=c[r][o]&&1!=c[r][o])return void u(r,o);f=r,d=o,t=$(".color_picker").val(),f>=0&&f<l&&d>=0&&d<v&&(a.arc({basic:[20+i*(1+2*f),20+i*(1+2*d),i-4,0,2*Math.PI],strokeColor:t,fillColor:t}),c[f][d]=t)}}var f,d;var h,_}(e)}),$(".color_picker").minicolors({letterCase:"uppercase"}),$(".pindou_shape").change(function(){s=$(".pindou_shape:checked").val()}),$(".clear_canvas").click(function(){if(1!=confirm("是否确定清空？"))return!1;a.clean(0,0,e.width,e.height)}),$(".siser_ok").click(function(){if(1!=confirm("更换画布会清空拼豆，是否确定？"))return!1;l=$(".siser_col").val(),v=$(".siser_row").val(),r.clean(0,0,o.width,o.height),f()})});