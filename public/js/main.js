$(document).ready(function(){var e=document.getElementById("canvas_coord"),t=e.getContext("2d"),o=document.getElementById("canvas"),l=o.getContext("2d"),i=[],r=34,c=r/2,a=$(".color_picker").val(),n=$(".bg_color").val(),s=$(".pindou_shape:checked").val(),f=$(".siser_col").val(),h=$(".siser_row").val();function v(){var l=f*r,c=h*r;e.width=l+100,e.height=c+100,o.width=l+100,o.height=c+100;for(var a=20;a<=c+20;a+=r)t.beginPath(),t.fillStyle="#000",t.fillText((a-20)/r,0,a-20),t.moveTo(20,a),t.lineTo(l+20,a),t.closePath(),t.stroke();for(a=20;a<=l+20;a+=r)t.beginPath(),t.fillText((a-20)/r,a-20,10),t.moveTo(a,20),t.lineTo(a,c+20),t.closePath(),t.stroke();i=[];for(var n=0;n<f;n++){i[n]=[];for(var s=0;s<h;s++)i[n][s]=0}O(".color_count").html("0")}function u(e){var t,o,n,v,u=parseInt((e.offsetX-c)/r),g=parseInt((e.offsetY-c)/r);if(!(u<f&&g<h))return!1;if("rectangle"==s){if(0!=i[u][g]&&1!=i[u][g])return void d(u,g);n=u,v=g,a=$(".color_picker").val(),n>=0&&n<f&&v>=0&&v<h&&(l.fillStyle=a,l.beginPath(),l.rect(20+r*n+2,20+r*v+2,r-4,r-4),l.closePath(),l.fill(),i[n][v]=a)}else{if(0!=i[u][g]&&1!=i[u][g])return void d(u,g);t=u,o=g,a=$(".color_picker").val(),t>=0&&t<f&&o>=0&&o<h&&(l.fillStyle=a,l.beginPath(),l.arc(20+c*(1+2*t),20+c*(1+2*o),c-4,0,2*Math.PI,!0),l.closePath(),l.fill(),i[t][o]=a)}}function d(e,t){l.fillStyle=n,l.beginPath(),l.rect(20+r*e+1,20+r*t+1,r-2,r-2),l.closePath(),l.fill(),i[e][t]=1}v(),O("#canvas").mousedown(function(e){u(e)}),O(".siser_ok").click(function(){if(1!=confirm("更换画布会清空拼豆，是否确定？"))return!1;f=$(".siser_col").val(),h=$(".siser_row").val(),l.clearRect(0,0,o.width,o.height),v()}),O(".clear_canvas").click(function(){if(1!=confirm("是否确定清空？"))return!1;l.clearRect(0,0,o.width,o.height),v()}),$(".color_picker").minicolors({letterCase:"uppercase"}),$(".bg_color").minicolors({letterCase:"uppercase",hide:function(){O("&body").setCss({backgroundColor:$(this).val()}),n=$(this).val();for(var e=0;e<f;e++)for(var t=0;t<h;t++)1==i[e][t]&&(l.fillStyle=n,l.beginPath(),l.rect(20+r*e+1,20+r*t+1,r-2,r-2),l.closePath(),l.fill())}}),$(".pindou_shape").change(function(){s=$(".pindou_shape:checked").val()})});