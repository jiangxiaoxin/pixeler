$(document).ready(function(){var e=document.getElementById("canvas_coord"),t=e.getContext("2d"),o=document.getElementById("canvas"),c=o.getContext("2d"),i=[],l=34,r=l/2,n=$(".color_picker").val(),a=($(".bg_color").val(),$(".pindou_shape:checked").val()),s=$(".siser_col").val(),f=$(".siser_row").val();function h(){var c=s*l,r=f*l;e.width=c+100,e.height=r+100,o.width=c+100,o.height=r+100;for(var n=20;n<=r+20;n+=l)t.beginPath(),t.fillStyle="#000",t.fillText((n-20)/l,0,n-20),t.moveTo(20,n),t.lineTo(c+20,n),t.closePath(),t.stroke();for(n=20;n<=c+20;n+=l)t.beginPath(),t.fillText((n-20)/l,n-20,10),t.moveTo(n,20),t.lineTo(n,r+20),t.closePath(),t.stroke();i=[];for(var a=0;a<s;a++){i[a]=[];for(var h=0;h<f;h++)i[a][h]=0}O(".color_count").html("0")}function v(e){var t,o,h,v,d=parseInt((e.offsetX-r)/l),g=parseInt((e.offsetY-r)/l);if(!(d<s&&g<f))return!1;if("rectangle"==a){if(0!=i[d][g]&&1!=i[d][g])return void u(d,g);h=d,v=g,n=$(".color_picker").val(),h>=0&&h<s&&v>=0&&v<f&&(c.fillStyle=n,c.beginPath(),c.rect(20+l*h+2,20+l*v+2,l-4,l-4),c.closePath(),c.fill(),i[h][v]=n)}else{if(0!=i[d][g]&&1!=i[d][g])return void u(d,g);t=d,o=g,n=$(".color_picker").val(),t>=0&&t<s&&o>=0&&o<f&&(c.fillStyle=n,c.beginPath(),c.arc(20+r*(1+2*t),20+r*(1+2*o),r-4,0,2*Math.PI,!0),c.closePath(),c.fill(),i[t][o]=n)}}function u(e,t){c.beginPath(),c.clearRect(20+l*e+1,20+l*t+1,l-2,l-2),c.closePath(),i[e][t]=1}h(),O("#canvas").mousedown(function(e){v(e)}),O(".siser_ok").click(function(){if(1!=confirm("更换画布会清空拼豆，是否确定？"))return!1;s=$(".siser_col").val(),f=$(".siser_row").val(),c.clearRect(0,0,o.width,o.height),h()}),O(".clear_canvas").click(function(){if(1!=confirm("是否确定清空？"))return!1;c.clearRect(0,0,o.width,o.height),h()}),$(".color_picker").minicolors({letterCase:"uppercase"}),$(".pindou_shape").change(function(){a=$(".pindou_shape:checked").val()})});